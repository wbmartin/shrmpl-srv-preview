#!/bin/bash

set -e

echo "Building Shrmpl-Vault for release..."

# Get project directory (parent of bin)
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_DIR="$(dirname "$SCRIPT_DIR")"

# Create dist directories
mkdir -p "$PROJECT_DIR/dist/mac"
mkdir -p "$PROJECT_DIR/dist/linux"

# Build for Mac (Apple Silicon)
echo "Building for macOS (aarch64-apple-darwin)..."
cd "$PROJECT_DIR"
cargo build --release --target aarch64-apple-darwin --bin shrmpl-vault-srv
cp target/aarch64-apple-darwin/release/shrmpl-vault-srv "$PROJECT_DIR/dist/mac/"

# Build for Linux (x86_64)
echo "SKIPPING Building for Linux (x86_64-unknown-linux-gnu)... Never works on a mac"


echo "Build complete. Binaries in dist/mac, but NOT dist/linux"
